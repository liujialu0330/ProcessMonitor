# PRD - 进程监控助手

## 文档版本历史

| 版本号 | 日期 | 修订内容 | 作者 |
|--------|------|----------|------|
| v1.0.0 | 2025-11-15 | 初始版本，完成基础功能设计 | 测试团队 |

---

## 1. 产品概述

### 1.1 产品定位
进程监控助手是一款专业的Windows桌面应用程序，旨在为软件测试人员提供强大的进程性能监控工具，帮助发现和诊断内存泄漏、CPU占用异常等性能问题。

### 1.2 产品目标
- 提供实时的进程性能指标监控
- 记录并可视化历史监控数据
- 简化测试流程，提高测试效率
- 提供现代化、易用的用户界面

### 1.3 目标用户
- **主要用户**：软件测试工程师
- **次要用户**：性能测试工程师、开发工程师
- **使用场景**：
  - 桌面应用性能测试
  - 内存泄漏检测
  - CPU占用分析
  - 长时间运行稳定性测试

---

## 2. 核心功能需求

### 2.1 实时监控功能

#### 2.1.1 进程选择
**需求描述**：用户可以通过多种方式选择要监控的进程

**功能要求**：
- 支持通过PID直接输入选择进程
- 支持从系统进程列表中选择进程
- 进程列表支持刷新，获取最新运行进程
- 显示进程名称和PID信息

**优先级**：P0（必须）

#### 2.1.2 指标选择
**需求描述**：提供多种性能指标供用户选择监控

**支持的指标**：

| 分类 | 指标名称 | 说明 | 单位 |
|------|---------|------|------|
| 内存 | 工作集内存 | 进程实际占用的物理内存 | MB |
| 内存 | 虚拟内存 | 进程使用的虚拟内存大小 | MB |
| 内存 | 内存使用率 | 占系统总内存的百分比 | % |
| CPU | CPU使用率 | 进程CPU占用百分比 | % |
| 系统资源 | 线程数 | 进程创建的线程数量 | 个 |
| 系统资源 | 句柄数 | 进程打开的句柄数量 | 个 |
| IO | IO读取字节 | 累计读取的数据量 | MB |
| IO | IO写入字节 | 累计写入的数据量 | MB |

**优先级**：P0（必须）

#### 2.1.3 采集周期配置
**需求描述**：用户可以自定义数据采集的时间间隔

**功能要求**：
- 支持预设的采集周期：0.5秒、1秒、2秒、5秒、10秒
- 默认采集周期为1秒
- 采集周期范围：0.1秒 ~ 60秒

**优先级**：P1（重要）

#### 2.1.4 多任务监控
**需求描述**：支持同时监控多个进程的不同指标

**功能要求**：
- 最多同时监控5个任务
- 每个任务独立配置监控指标和采集周期
- 达到任务上限时给出明确提示
- 支持单独停止某个监控任务

**约束条件**：
- 最大并发任务数：5个
- 防止系统资源过度占用

**优先级**：P0（必须）

#### 2.1.5 实时数据显示
**需求描述**：以卡片形式实时显示监控数据

**显示内容**：
- 进程名称和PID
- 监控的指标类型
- 当前指标值（带单位格式化）
- 停止按钮

**更新频率**：根据采集周期实时更新

**优先级**：P0（必须）

### 2.2 历史数据功能

#### 2.2.1 数据持久化
**需求描述**：所有监控数据自动保存到本地数据库

**功能要求**：
- 使用SQLite数据库存储
- 批量保存优化性能（默认10条一批）
- 自动管理数据库连接
- 支持长时间监控数据存储

**优先级**：P0（必须）

#### 2.2.2 历史任务查看
**需求描述**：用户可以查看所有监控任务的历史记录

**功能要求**：
- 显示所有任务（包括运行中和已停止）
- 任务信息包含：进程名、PID、指标、开始时间
- 支持任务选择和切换

**优先级**：P0（必须）

#### 2.2.3 数据可视化
**需求描述**：以图表形式展示监控数据趋势

**功能要求**：
- 折线图显示数据随时间变化
- X轴：时间（相对时间，单位：秒）
- Y轴：指标值（自动缩放）
- 图表交互：缩放、平移

**优先级**：P0（必须）

#### 2.2.4 数据表格
**需求描述**：以表格形式展示详细数据点

**功能要求**：
- 列：时间、格式化值、原始值
- 按时间倒序排列（最新在前）
- 支持滚动查看
- 禁止编辑

**优先级**：P1（重要）

---

## 3. 非功能需求

### 3.1 性能要求
- 应用启动时间：< 3秒
- 数据采集延迟：< 100ms
- UI响应时间：< 200ms
- 支持长时间运行（24小时+）不崩溃

### 3.2 兼容性要求
- 操作系统：Windows 10/11 (64位)
- Python版本：3.8+
- 屏幕分辨率：1280x720 及以上

### 3.3 可靠性要求
- 进程异常终止时自动停止监控任务
- 数据库异常时给出明确错误提示
- 采集失败时不影响其他任务
- 应用崩溃前自动保存未写入数据

### 3.4 易用性要求
- 界面直观，符合Windows 11设计规范
- 关键操作有明确反馈（成功/失败/警告）
- 错误提示准确且易于理解
- 无需培训即可上手使用

### 3.5 可维护性要求
- 代码模块化，职责清晰
- 遵循PEP 8编码规范
- 关键代码有注释说明
- 提供完整的项目文档

---

## 4. 用户界面需求

### 4.1 整体风格
- 采用Windows 11 Fluent Design设计语言
- 使用PyQt-Fluent-Widgets组件库
- 支持浅色/深色主题自动切换
- 现代、简洁、专业

### 4.2 主窗口
- 窗口标题：进程监控助手
- 默认大小：1000x700 像素
- 最小尺寸：800x600 像素
- 窗口居中显示
- 支持最大化、最小化

### 4.3 导航结构
- 侧边栏导航（可折叠）
- 两个Tab页：
  1. 实时监控
  2. 历史数据
- 导航图标清晰易识别

### 4.4 实时监控页面布局

```
┌─────────────────────────────────────────────┐
│  创建监控任务（卡片区域）                    │
│  ┌─────────────────────────────────────┐   │
│  │ 进程PID: [输入框]  或  选择进程: [▾]│   │
│  │ 监控指标: [下拉框▾]                 │   │
│  │ 采集周期: [1秒▾]                    │   │
│  │                    [开始监控按钮]   │   │
│  └─────────────────────────────────────┘   │
├─────────────────────────────────────────────┤
│  监控任务列表                                │
│  ┌─────────────────────────────────────┐   │
│  │ 📊 chrome.exe (PID: 1234)          │   │
│  │    指标: 工作集内存                 │   │
│  │    当前值: 256.5 MB    [停止按钮]  │   │
│  └─────────────────────────────────────┘   │
│  ┌─────────────────────────────────────┐   │
│  │ 📊 notepad.exe (PID: 5678)         │   │
│  │    指标: CPU使用率                  │   │
│  │    当前值: 5.2 %       [停止按钮]  │   │
│  └─────────────────────────────────────┘   │
└─────────────────────────────────────────────┘
```

### 4.5 历史数据页面布局

```
┌─────────────────────────────────────────────┐
│  选择任务: [下拉框▾]          [刷新按钮]    │
├─────────────────────────────────────────────┤
│  数据趋势图（卡片区域）                      │
│  ┌─────────────────────────────────────┐   │
│  │     值                               │   │
│  │  200│    ╱╲                          │   │
│  │  150│   ╱  ╲  ╱╲                    │   │
│  │  100│  ╱    ╲╱  ╲                   │   │
│  │   50│ ╱          ╲                  │   │
│  │    0└──────────────→ 时间(秒)       │   │
│  └─────────────────────────────────────┘   │
├─────────────────────────────────────────────┤
│  详细数据（表格）                            │
│  ┌─────────────────────────────────────┐   │
│  │ 时间     │ 值       │ 原始值        │   │
│  │ 12:00:01 │ 100 MB  │ 100.234567   │   │
│  │ 12:00:02 │ 105 MB  │ 105.123456   │   │
│  └─────────────────────────────────────┘   │
└─────────────────────────────────────────────┘
```

### 4.6 交互反馈
- 成功操作：绿色提示条，1秒后消失
- 警告信息：黄色提示条，2秒后消失
- 错误信息：红色提示条，3秒后消失
- 按钮点击：鼠标悬停变色，点击有反馈

---

## 5. 技术约束

### 5.1 技术栈
- **UI框架**：PyQt5
- **UI组件库**：PyQt-Fluent-Widgets (>= 1.1.0)
- **进程监控**：psutil (>= 5.9.0)
- **数据可视化**：pyqtgraph (>= 0.13.0)
- **数据存储**：SQLite (Python内置)

### 5.2 架构要求
- 分层架构：UI层、业务逻辑层、数据层、工具层
- 前后端分离：UI和业务逻辑解耦
- 高内聚低耦合：模块职责单一
- 使用Qt信号槽实现跨线程通信

### 5.3 开发规范
- 遵循PEP 8代码规范
- 使用类型提示（Type Hints）
- 编写文档字符串（Docstring）
- 关键功能有单元测试

---

## 6. 数据模型

### 6.1 监控任务（MonitorTask）
```python
{
    "task_id": "UUID字符串",
    "pid": "进程ID",
    "process_name": "进程名称",
    "metric_type": "指标类型",
    "interval": "采集间隔(秒)",
    "start_time": "开始时间",
    "end_time": "结束时间(可空)",
    "status": "running | stopped"
}
```

### 6.2 数据点（DataPoint）
```python
{
    "task_id": "所属任务ID",
    "timestamp": "时间戳",
    "value": "指标值(浮点数)"
}
```

---

## 7. 系统流程

### 7.1 创建监控任务流程
```
用户输入PID/选择进程
    ↓
选择监控指标
    ↓
选择采集周期
    ↓
点击"开始监控"
    ↓
系统检查任务数量限制
    ↓
创建监控任务(QThread)
    ↓
保存任务信息到数据库
    ↓
启动后台线程
    ↓
定时采集数据
    ↓
更新UI显示
    ↓
批量保存数据到数据库
```

### 7.2 停止监控任务流程
```
用户点击"停止"按钮
    ↓
发送停止信号
    ↓
线程安全停止
    ↓
保存剩余数据
    ↓
更新任务状态
    ↓
移除任务卡片
    ↓
释放资源
```

### 7.3 查看历史数据流程
```
切换到历史数据页面
    ↓
加载所有任务列表
    ↓
用户选择任务
    ↓
从数据库查询数据点
    ↓
绘制趋势图
    ↓
填充数据表格
```

---

## 8. 异常处理

### 8.1 进程不存在
- **场景**：用户输入的PID不存在或无法访问
- **处理**：显示错误提示，禁止创建任务

### 8.2 进程已终止
- **场景**：监控过程中进程意外终止
- **处理**：自动停止监控任务，保存已采集数据，提示用户

### 8.3 数据库异常
- **场景**：数据库文件损坏或权限不足
- **处理**：显示错误信息，尝试重新初始化数据库

### 8.4 任务数量超限
- **场景**：用户尝试创建第6个监控任务
- **处理**：显示警告提示，禁止创建

---

## 9. 后续规划

### 9.1 v1.1.0 规划功能
- [ ] 支持自定义采集周期输入
- [ ] 导出历史数据为CSV/Excel格式
- [ ] 设置数据保留策略（自动清理旧数据）
- [ ] 添加多进程对比视图
- [ ] 支持进程名称模糊搜索

### 9.2 v1.2.0 规划功能
- [ ] 添加告警功能（指标超过阈值时提醒）
- [ ] 支持自定义阈值配置
- [ ] 生成性能测试报告
- [ ] 支持配置文件导入/导出
- [ ] 添加进程启动监控功能

### 9.3 v2.0.0 规划功能
- [ ] 支持远程监控（监控其他机器的进程）
- [ ] 支持Linux系统
- [ ] 添加插件系统
- [ ] 云端数据同步
- [ ] 团队协作功能

---

## 10. 验收标准

### 10.1 功能验收
- ✅ 能够成功监控系统中的任意进程
- ✅ 支持所有列出的性能指标
- ✅ 数据实时更新且准确
- ✅ 历史数据正确保存和展示
- ✅ 所有交互操作有明确反馈

### 10.2 性能验收
- ✅ 应用启动时间 < 3秒
- ✅ UI响应流畅，无卡顿
- ✅ 长时间运行稳定（24小时测试）
- ✅ 内存占用稳定，无泄漏

### 10.3 易用性验收
- ✅ 新用户5分钟内能完成第一次监控
- ✅ 界面美观，符合现代设计规范
- ✅ 错误提示清晰易懂
- ✅ 文档完整，易于理解

---

## 附录：术语表

| 术语 | 解释 |
|------|------|
| PID | Process ID，进程标识符 |
| RSS | Resident Set Size，工作集内存 |
| VMS | Virtual Memory Size，虚拟内存大小 |
| CPU使用率 | 进程占用CPU的百分比 |
| 句柄 | Windows系统资源的引用 |
| IO | Input/Output，输入输出操作 |
| Qt信号槽 | Qt框架的事件通信机制 |
| QThread | Qt的线程类 |
| SQLite | 轻量级关系型数据库 |

---

**文档状态**：已发布
**下次评审日期**：根据实际开发进度确定
**文档维护者**：测试团队
